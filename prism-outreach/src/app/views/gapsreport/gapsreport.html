<main id="main" class="main" style="margin-top:50px!important;min-height:550px;">
  <section class="section dashboard">
    <div class="row">

      <!-- Search Filters -->
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-lg-10">
                <!-- Search Form -->
                <form (ngSubmit)="searchData()" #searchForm="ngForm">
                  <div class="row g-2 align-items-center">
                    <div class="col-lg-4"></div>

                    <!-- START DATE -->
                    <div class="col-lg-2">
                      <input 
                        type="text"
                        id="start_date"
                        class="form-control text-uppercase"
                        placeholder="Start Date"
                        [value]="formatForDisplay(startDate)"
                        (change)="updateStartDate($event.target.value)"
                        autocomplete="off"
                      />

                      <!-- hidden actual YYYY-MM-DD model -->
                      <input type="date" class="d-none" [(ngModel)]="startDate" name="start_date">
                    </div>

                    <!-- END DATE -->
                    <div class="col-lg-2">
                      <input 
                        type="text"
                        id="end_date"
                        class="form-control text-uppercase"
                        placeholder="End Date"
                        [value]="formatForDisplay(endDate)"
                        (change)="updateEndDate($event.target.value)"
                        autocomplete="off"
                      />

                      <!-- hidden actual YYYY-MM-DD model -->
                      <input type="date" class="d-none" [(ngModel)]="endDate" name="end_date">
                    </div>

                    <div class="col-lg-4">
                      <button type="submit" class="btn btn-primary">
                        SEARCH
                      </button>
                    </div>
                  </div>
                </form>
              </div>

              <div class="col-lg-2 text-end">
                <button class="btn btn-primary" (click)="downloadCsv()">
                  DOWNLOAD CSV
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">

            <table class="table table-striped table-hover" id="gaps" *ngIf="gapsData.length > 0">
              <thead class="table-light">
                <tr>
                  <th>MEDICAID ID</th>
                  <th>TYPE</th>
                  <th>DIAG CODE</th>
                  <th>DIAG DESC</th>
                  <th>Observation Date</th>
                  <th>Observation Year</th>
                  <th>Observation Code</th>
                  <th>CPT Modifier</th>
                  <th>Code Set</th>
                  <th>Result</th>
                  <th>Provider NPI</th>
                  <th>Taxonomy Code</th>
                  <th>Provider Name</th>
                  <th>Provider Type</th>
                  <th>RxProviderFlag</th>
                  <th>Group NPI</th>
                  <th>Group Taxonomy</th>
                  <th>Group Name</th>
                  <th>Source</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let gap of gapsData">
                  <td>{{ gap.medicaid_id }}</td>
                  <td>{{ gap.TYPE }}</td>
                  <td>{{ gap.DIAG_CODE || gap.Gap_Code }}</td>
                  <td>{{ gap.DIAG_DESC }}</td>
                  <td>{{ gap.ObservationDate | date: 'MM/dd/yyyy' }}</td>
                  <td>{{ gap.Observation_Year }}</td>
                  <td>{{ gap.Observation_Code }}</td>
                  <td>{{ gap.CPT_Code_Modifier }}</td>
                  <td>{{ gap.Observation_Code_Set }}</td>
                  <td>{{ gap.Observation_Result }}</td>
                  <td>{{ gap.Service_Provider_NPI }}</td>
                  <td>{{ gap.Service_Provider_Taxonomy_Code }}</td>
                  <td>{{ gap.Service_Provider_Name }}</td>
                  <td>{{ gap.Service_Provider_Type }}</td>
                  <td>{{ gap.Service_Provider_RxProviderFlag }}</td>
                  <td>{{ gap.Provider_Group_NPI }}</td>
                  <td>{{ gap.Provider_Group_Taxonomy_Code }}</td>
                  <td>{{ gap.Provider_Group_Name }}</td>
                  <td>{{ gap.Source }}</td>
                </tr>
              </tbody>
            </table>

            <div *ngIf="gapsData.length === 0 && dataLoaded" class="text-center p-4">
              <p class="text-muted mb-0">No records found for the selected date range.</p>
            </div>

            <div *ngIf="!dataLoaded" class="text-center p-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>

          </div>
        </div>
      </div>

    </div>
  </section>
</main>